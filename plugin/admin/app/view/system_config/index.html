<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="/app/admin/component/layui/css/layui.css?v=2.8.12"/>
    <link rel="stylesheet" href="/app/admin/component/pear/css/pear.css"/>
    <link rel="stylesheet" href="/app/admin/admin/css/reset.css"/>
</head>
<body class="pear-container">
<style>
    .layui-input-block input {
        width: 300px;
    }
</style>

<div class="layui-card">
    <div class="layui-card-body">

        <div class="layui-tab layui-tab-brief">
            <ul class="layui-tab-title">
                <li class="layui-this">基本信息</li>
                <li>质押</li>
                <li>套利</li>
            </ul>
            <div class="layui-tab-content">

                <!-- 基本信息 -->
                <div class="layui-tab-item layui-show">

                    <form class="layui-form" lay-filter="baseInfo">
                        <div class="layui-form-item">
                            <label class="layui-form-label">系统维护</label>
                            <div class="layui-input-block">
                                <input type="checkbox" name="maintenance_mode" lay-skin="switch" />
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">维护提示</label>
                            <div class="layui-input-block">
                                <input type="text" name="maintenance_message" placeholder="系统维护提示" autocomplete="off"
                                       class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">官方网址</label>
                            <div class="layui-input-block">
                                <input type="text" name="web_url" placeholder="请输入官方网址" autocomplete="off"
                                       class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">分享链接</label>
                            <div class="layui-input-block">
                                <input type="text" name="share_url" placeholder="请输入分享链接" autocomplete="off"
                                       class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">钱包地址</label>
                            <div class="layui-input-block">
                                <input type="text" name="wallet_address" placeholder="请输入钱包地址" autocomplete="off"
                                       class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">最低质押</label>
                            <div class="layui-inline">
                                <div class="layui-input-inline" style="width: 100px;">
                                    <input type="number" name="ckb_min_number" placeholder="最低质押" autocomplete="off"
                                           class="layui-input" min="0" step="1" lay-affix="number">
                                </div>
                                <div class="layui-form-mid">个</div>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">最低套利</label>
                            <div class="layui-inline">
                                <div class="layui-input-inline" style="width: 100px;">
                                    <input type="number" name="sol_min_number" placeholder="最低套利" autocomplete="off"
                                           class="layui-input" min="0" step="1" lay-affix="number">
                                </div>
                                <div class="layui-form-mid">个</div>
                            </div>

                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">最低兑现</label>
                            <div class="layui-inline">
                                <div class="layui-input-inline" style="width: 100px;">
                                    <input type="number" name="exchange_min_number" placeholder="最低兑现" autocomplete="off"
                                           class="layui-input" min="0" step="1" lay-affix="number">
                                </div>
                                <div class="layui-form-mid">个</div>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">最低提现</label>
                            <div class="layui-inline">
                                <div class="layui-input-inline" style="width: 100px;">
                                    <input type="number" name="withdraw_min_number" placeholder="最低提现" autocomplete="off"
                                           class="layui-input" min="0" step="1" lay-affix="number">
                                </div>
                                <div class="layui-form-mid">个</div>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">提现手续费</label>
                            <div class="layui-inline">
                                <div class="layui-input-inline" style="width: 100px;">
                                    <input type="number" name="withdraw_fee_rate" placeholder="" autocomplete="off"
                                           class="layui-input" min="0" step="1" lay-affix="number">
                                </div>
                                <div class="layui-form-mid">%</div>
                            </div>
                        </div>

                        <div class="layui-form-item">
                            <div class="layui-input-block">
                                <button type="submit" class="pear-btn pear-btn-primary pear-btn-md" lay-submit=""
                                        lay-filter="saveBaseInfo">
                                    提交
                                </button>
                            </div>
                        </div>
                    </form>

                </div>

                <!-- 质押 -->
                <div class="layui-tab-item">
                    <div class="layui-tab layui-tab-card">
                        <ul class="layui-tab-title">
                            <li class="layui-this">CKB</li>
                            <li>ONE</li>
                        </ul>
                        <div class="layui-tab-content">

                            <!-- CKB -->
                            <div class="layui-tab-item layui-show">
                                <form class="layui-form" lay-filter="ckbInfo" style="padding: 20px;">

                                    <div class="layui-card" style="margin-top: 10px;">
                                        <div class="layui-card-header">每日收益</div>
                                    </div>
                                    <div id="staticRateCkb"></div>


                                    <div class="layui-card" style="margin-top: 10px;">
                                        <div class="layui-card-header">直推分享奖</div>
                                    </div>
                                    <div class="layui-form-item">
                                        <div class="layui-inline">
                                            <div class="layui-input-inline" style="width: 100px;">
                                                <input type="number" name="directRate" placeholder="" autocomplete="off"
                                                       class="layui-input" min="0" step="1" lay-affix="number">
                                            </div>
                                            <div class="layui-form-mid">%</div>
                                        </div>
                                    </div>

                                    <div class="layui-card" style="margin-top: 10px;">
                                        <div class="layui-card-header">动态分享</div>
                                    </div>
                                    <div id="levelDiffRateCkb"></div>


                                    <div class="layui-card" style="margin-top: 10px;">
                                        <div class="layui-card-header">平级奖</div>
                                    </div>
                                    <div class="layui-form-item">
                                        <div class="layui-inline">
                                            <div class="layui-input-inline" style="width: 100px;">
                                                <input type="number" name="sameLevelRate" placeholder="" autocomplete="off"
                                                       class="layui-input" min="0" step="1" lay-affix="number">
                                            </div>
                                            <div class="layui-form-mid">%</div>
                                        </div>
                                    </div>

                                    <div class="layui-form-item">
                                        <div class="layui-input-block">
                                            <button type="submit" class="pear-btn pear-btn-primary pear-btn-md" lay-submit=""
                                                    lay-filter="saveCkb">
                                                提交
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>

                            <!-- ONE -->
                            <div class="layui-tab-item">
                                <form class="layui-form" lay-filter="oneInfo" style="padding: 20px;">

                                    <div class="layui-card" style="margin-top: 10px;">
                                        <div class="layui-card-header">每日收益</div>
                                    </div>
                                    <div id="staticRateOne"></div>


                                    <div class="layui-card" style="margin-top: 10px;">
                                        <div class="layui-card-header">直推分享奖</div>
                                    </div>
                                    <div class="layui-form-item">
                                        <div class="layui-inline">
                                            <div class="layui-input-inline" style="width: 100px;">
                                                <input type="number" name="directRate" placeholder="" autocomplete="off"
                                                       class="layui-input" min="0" step="1" lay-affix="number">
                                            </div>
                                            <div class="layui-form-mid">%</div>
                                        </div>
                                    </div>

                                    <div class="layui-card" style="margin-top: 10px;">
                                        <div class="layui-card-header">动态分享</div>
                                    </div>
                                    <div id="levelDiffRateOne"></div>


                                    <div class="layui-card" style="margin-top: 10px;">
                                        <div class="layui-card-header">平级奖</div>
                                    </div>
                                    <div class="layui-form-item">
                                        <div class="layui-inline">
                                            <div class="layui-input-inline" style="width: 100px;">
                                                <input type="number" name="sameLevelRate" placeholder="" autocomplete="off"
                                                       class="layui-input" min="0" step="1" lay-affix="number">
                                            </div>
                                            <div class="layui-form-mid">%</div>
                                        </div>
                                    </div>

                                    <div class="layui-form-item">
                                        <div class="layui-input-block">
                                            <button type="submit" class="pear-btn pear-btn-primary pear-btn-md" lay-submit=""
                                                    lay-filter="saveOne">
                                                提交
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- tab设置 -->
                <div class="layui-tab-item">

                    <div class="layui-tab layui-tab-card">
                        <ul class="layui-tab-title">
                            <li class="layui-this">USDT</li>
                        </ul>
                        <div class="layui-tab-content">

                            <!-- USDT -->
                            <div class="layui-tab-item layui-show">
                                <form class="layui-form" lay-filter="usdtInfo" style="padding: 20px;">

                                    <div class="layui-card" style="margin-top: 10px;">
                                        <div class="layui-card-header">每日收益</div>
                                    </div>
                                    <div id="solStaticRateUsdt"></div>


                                    <div class="layui-card" style="margin-top: 10px;">
                                        <div class="layui-card-header">直推分享奖</div>
                                    </div>
                                    <div class="layui-form-item">
                                        <div class="layui-inline">
                                            <div class="layui-input-inline" style="width: 100px;">
                                                <input type="number" name="directRate" placeholder="" autocomplete="off"
                                                       class="layui-input" min="0" step="1" lay-affix="number">
                                            </div>
                                            <div class="layui-form-mid">%</div>
                                        </div>
                                    </div>

                                    <div class="layui-card" style="margin-top: 10px;">
                                        <div class="layui-card-header">动态分享</div>
                                    </div>
                                    <div id="solLevelDiffRateUsdt"></div>


                                    <div class="layui-card" style="margin-top: 10px;">
                                        <div class="layui-card-header">平级奖</div>
                                    </div>
                                    <div class="layui-form-item">
                                        <div class="layui-inline">
                                            <div class="layui-input-inline" style="width: 100px;">
                                                <input type="number" name="sameLevelRate" placeholder="" autocomplete="off"
                                                       class="layui-input" min="0" step="1" lay-affix="number">
                                            </div>
                                            <div class="layui-form-mid">%</div>
                                        </div>
                                    </div>

                                    <div class="layui-form-item">
                                        <div class="layui-input-block">
                                            <button type="submit" class="pear-btn pear-btn-primary pear-btn-md" lay-submit=""
                                                    lay-filter="saveUsdt">
                                                提交
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>


                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>
</div>


<script src="/app/admin/component/layui/layui.js?v=2.8.12"></script>
<script src="/app/admin/component/pear/pear.js"></script>
<script src="/app/admin/admin/js/permission.js"></script>
<script>
    window.onload = function () {
        // 基础设置
        layui.use(["upload", "layer", "popup"], function () {
            let $ = layui.$;
            let form = layui.form;

            // 提交
            form.on("submit(saveBaseInfo)", function (data) {
                $.ajax({
                    url: "/app/admin/systemConfig/update",
                    dataType: "json",
                    type: "POST",
                    data: {base_info: data.field},
                    success: function (res) {
                        if (res.code) {
                            return layui.popup.failure(res.msg);
                        }
                        return layui.popup.success("操作成功");
                    }
                });
                return false;
            });
        });

        // ckb
        layui.use(["upload", "layer", "popup"], function () {
            let $ = layui.$;
            let form = layui.form;
            // 提交
            form.on("submit(saveCkb)", function (data) {
                $.ajax({
                    url: "/app/admin/systemConfig/update",
                    dataType: "json",
                    type: "POST",
                    data: {pledge: { "ckb": JSON.stringify(data.field) }},
                    success: function (res) {
                        if (res.code) {
                            return layui.popup.failure(res.msg);
                        }
                        return layui.popup.success("操作成功");
                    }
                });
                return false;
            });
        });

        layui.use(["upload", "layer", "popup"], function () {
            let $ = layui.$;
            let form = layui.form;
            // 提交
            form.on("submit(saveOne)", function (data) {
                $.ajax({
                    url: "/app/admin/systemConfig/update",
                    dataType: "json",
                    type: "POST",
                    data: {pledge: { "one": JSON.stringify(data.field) }},
                    success: function (res) {
                        if (res.code) {
                            return layui.popup.failure(res.msg);
                        }
                        return layui.popup.success("操作成功");
                    }
                });
                return false;
            });
        });

        // 标签设置
        layui.use(["upload", "layer", "popup"], function () {
            let $ = layui.$;
            let form = layui.form;
            // 提交
            form.on("submit(saveUsdt)", function (data) {
                let field = data.field;
                delete data.field;
                $.ajax({
                    url: "/app/admin/systemConfig/update",
                    dataType: "json",
                    type: "POST",
                    data:  {mev: { "usdt": JSON.stringify(field) }},
                    success: function (res) {
                        if (res.code) {
                            return layui.popup.failure(res.msg);
                        }
                        return layui.popup.success("操作成功");
                    }
                });
                // 删除sessionStorage缓存
                sessionStorage.clear();
                return false;
            });
        });

        layui.use(["form"], function () {
            let form = layui.form;
            let $ = layui.$;
            $.ajax({
                url: "/app/admin/systemConfig/get",
                dataType: "json",
                success: function (res) {
                    if (res.code) {
                        return layui.popup.failure(res.msg);
                    }
                    form.val("baseInfo", res.base_info);
                    form.val("ckbInfo", {
                        "directRate": res.pledge.ckb.directRate,
                        "sameLevelRate": res.pledge.ckb.sameLevelRate
                    });
                    form.val("oneInfo", {
                        "directRate": res.pledge.one.directRate,
                        "sameLevelRate": res.pledge.one.sameLevelRate
                    });

                    renderStaticRateTable(res.pledge.ckb.staticRate,"Ckb");
                    renderStaticRateTable(res.pledge.one.staticRate,"One");
                    renderLevelDiffRateTable(res.pledge.ckb.levelDiffRate,"Ckb");
                    renderLevelDiffRateTable(res.pledge.one.levelDiffRate,"One");

                    form.val("usdtInfo", {
                        "directRate": res.mev.usdt.directRate,
                        "sameLevelRate": res.mev.usdt.sameLevelRate
                    });

                    renderSolStaticRateTable(res.mev.usdt.staticRate,"Usdt");
                    renderSolLevelDiffRateTable(res.mev.usdt.levelDiffRate,"Usdt");
                }
            });


        });

        function renderStaticRateTable(data,id) {
            var container = document.getElementById("staticRate"+id);

            if (!container) {
                console.error("找不到 #staticRate元素！"+id);
                return;
            }
            container.innerHTML = ""; // 清空原有内容
            data.forEach(function (item, index) {
                var row = `<div class="layui-form-item">
                                <div class="layui-inline">
                                    <div class="layui-input-inline" style="width: 100px;">
                                        <input type="number" name="staticRate[${index}][day]"  value="${item.day}" placeholder="" autocomplete="off" class="layui-input" min="0"  max="100" step="1" lay-affix="number">
                                    </div>
                                    <div class="layui-form-mid">天</div>
                                    <div class="layui-input-inline" style="width: 100px;">
                                        <input type="number" name="staticRate[${index}][rate]" value="${item.rate}" placeholder="" autocomplete="off" class="layui-input" min="0" max="100" step="1" lay-affix="number">
                                    </div>
                                    <div class="layui-form-mid">%</div>
                                </div>
                            </div>`;
                container.innerHTML += row;
            });

            // form.render(); // 重新渲染表单
        }

        function renderLevelDiffRateTable(data,id) {
            var container = document.getElementById("levelDiffRate"+id);

            if (!container) {
                console.error("找不到 #levelDiffRate元素！"+id);
                return;
            }
            container.innerHTML = ""; // 清空原有内容
            data.forEach(function (item, index) {
                var row = `<div class="layui-form-item">
                                <div class="layui-inline">
                                    <div class="layui-input-inline" style="width: 100px;">
                                        <input type="text" disabled name="levelDiffRate[${index}][level]"  value="${item.level}" placeholder="" autocomplete="off" class="layui-input" min="0" step="1" lay-affix="number">
                                    </div>
                                    <div class="layui-form-mid">-</div>
                                    <div class="layui-input-inline" style="width: 100px;">`;
                if(index===0) {
                    row += `  <input type="number" name="levelDiffRate[${index}][rate]" disabled value="${item.rate}" placeholder="" autocomplete="off" class="layui-input" min="0"  max="100" step="1" lay-affix="number">`;
                }else{
                    row += `  <input type="number" name="levelDiffRate[${index}][rate]" value="${item.rate}" placeholder="" autocomplete="off" class="layui-input" min="0" max="100" step="1" lay-affix="number">`;

                }
                row += `</div>
                                    <div class="layui-form-mid">%</div>
                                </div>
                            </div>`;
                container.innerHTML += row;
            });

            // form.render(); // 重新渲染表单
        }

        function renderSolStaticRateTable(data,id) {
            var container = document.getElementById("solStaticRate"+id);

            if (!container) {
                console.error("找不到 #staticRate 元素！"+id);
                return;
            }
            container.innerHTML = ""; // 清空原有内容
            data.forEach(function (item, index) {
                var row = `<div class="layui-form-item">
                                <div class="layui-inline">
                                    <div class="layui-input-inline" style="width: 100px;">
                                        <input type="number" name="staticRate[${index}][day]"  value="${item.day}" placeholder="" autocomplete="off" class="layui-input" min="0" step="1" lay-affix="number">
                                    </div>
                                    <div class="layui-form-mid">天</div>
                                    <div class="layui-input-inline"  >

                                    <div class="layui-inline" style="width: 400px">
                                    <div class="layui-input-inline" style="width: 100px;">
                                        <input type="number" name="staticRate[${index}][rate][min]"  value="${item.rate.min}" placeholder="" autocomplete="off" class="layui-input" min="0" max="100" step="1" lay-affix="number">
                                    </div>
                                    <div class="layui-form-mid">-</div>
                                    <div class="layui-input-inline" style="width: 100px;">
                                        <input type="number" name="staticRate[${index}][rate][max]" value="${item.rate.max}" placeholder="" autocomplete="off" class="layui-input" min="0"  max="100" step="1" lay-affix="number">
                                    </div>
                                    <div class="layui-form-mid">%</div>
                                </div>
`;

                row += `</div>

                                </div>
                            </div>`;
                container.innerHTML += row;
            });

            // form.render(); // 重新渲染表单
        }

        function renderSolLevelDiffRateTable(data,id) {
            var container = document.getElementById("solLevelDiffRate"+id);

            if (!container) {
                console.error("找不到 #levelDiffRate 元素！"+id);
                return;
            }
            container.innerHTML = ""; // 清空原有内容
            data.forEach(function (item, index) {
                var row = `<div class="layui-form-item">
                                <div class="layui-inline">
                                    <div class="layui-input-inline" style="width: 100px;">
                                        <input type="text" disabled name="levelDiffRate[${index}][level]"  value="${item.level}" placeholder="" autocomplete="off" class="layui-input" min="0" step="1" lay-affix="number">
                                    </div>
                                    <div class="layui-form-mid">-</div>
                                    <div class="layui-input-inline" style="width: 100px;">`;
                if(index===0) {
                    row += `  <input type="number" name="levelDiffRate[${index}][rate]" disabled value="${item.rate}" placeholder="" autocomplete="off" class="layui-input" min="0" max="100" step="1" lay-affix="number">`;
                }else{
                    row += `  <input type="number" name="levelDiffRate[${index}][rate]" value="${item.rate}" placeholder="" autocomplete="off" class="layui-input" min="0" max="100" step="1" lay-affix="number">`;

                }
                row += `</div>
                                    <div class="layui-form-mid">%</div>
                                </div>
                            </div>`;
                container.innerHTML += row;
            });

            // form.render(); // 重新渲染表单
        }
    };
</script>

</body>
</html>
